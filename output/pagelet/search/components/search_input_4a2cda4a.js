define("pagelet/search/components/search_input.jsx",function(e,t,a){"use strict";function l(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var n=e("react"),s=l(n),r=e("reactRouter"),c=e("jquery"),o=l(c),i=e("static/minxins/utils"),u=e("pagelet/widget/components/header.jsx"),d=l(u),h=e("pagelet/widget/components/loading.jsx"),f=l(h),p=e("pagelet/widget/components/tabs.jsx"),m=(l(p),e("pagelet/widget/components/appItem.jsx")),y=l(m),g=e("constants"),v=e("pagelet/search/action/action"),E=l(v),S=e("pagelet/search/store/store"),b=l(S),C=s["default"].createClass({displayName:"Search",mixins:[r.History],getInitialState:function(){return{loading:!0,tabs:[{name:"iPhone",value:g.deviceType.IPHONE},{name:"iPad",value:g.deviceType.IPAD}],device:g.deviceType.IPHONE,country:g.countryCode.CHINA,searchResultList:[],hotWords:[],records:[],hot:"",page:1,total:0}},componentDidMount:function(){this.unSubscribe=b["default"].listen(this.onStateChange.bind(this)),E["default"].fetchHotApp(),E["default"].fetchHistory();var e=this.props.location.query;e.searchWord&&this.onSearch(e.searchWord),i.send({type:"search",opra:"pv",label:"搜索"})},componentWillUnmount:function(){this.unSubscribe()},onStateChange:function(e){e.searchResultList&&(e.searchResultList=this.state.searchResultList.concat(e.searchResultList)),this.setState(e)},onTagSelected:function(e){this.onSearch(e),i.send({type:"search",opra:"history",label:e})},onChooseDevice:function(e){var t=this,a=this.props.location.query;this.setState({device:e.value,searchResultList:[]},function(){E["default"].search(a.searchWord,1,t.state.country,t.state.device)})},onSearch:function(e){this.setState({searchResultList:[],page:1,total:0,hot:""}),E["default"].search(e,1,this.state.country,this.state.device),E["default"].addHistory(e),E["default"].searchWordHot(e),this.history.replaceState(null,this.props.location.pathname,{searchWord:e}),i.send({type:"search",opra:"search",label:e})},handleScroll:function(e){var t=e.target;t.offsetHeight+t.scrollTop+10>=t.scrollHeight&&!this.state.loading&&this.state.searchResultList.length<this.state.total&&this.loadMore()},loadMore:function(){var e=this.state.page+1,t=this.props.location.query;this.setState({page:e}),E["default"].search(t.searchWord,e)},onClickSearchItem:function(e){var t=this.props.location.query||{},a=o["default"].extend({},e),l="/detail/";l+=t.overlay?"4":"1",a.id=a.infoId||a.id,a.id=a.id||a.appId,a.device=this.state.device,a.country=g.countryToCode[a.country],this.history.pushState(null,l,a),i.send({type:"search",opra:"hot",label:a.title})},render:function(){var e=this,t=this.state,a=(t.deviceType,t.searchResultList),l=t.hotWords,n=t.records,r=this.state,c=this.props.location.query||{},o=c.searchWord;return s["default"].createElement("div",{className:"c-page input-search"},s["default"].createElement(d["default"],{searchValue:o,onSearch:this.onSearch,onCancelSearch:function(){return e.history.goBack()},type:"search"}),s["default"].createElement("div",{className:"default-view",style:{display:o?"none":"block"}},s["default"].createElement("label",null,"热门应用"),s["default"].createElement("div",{className:"tags hot-app"},l.map(function(t,a){return s["default"].createElement("span",{key:a,onClick:function(){return e.onClickSearchItem(t)}},t.title)}),l.length||"error"!=r.errorText?null:s["default"].createElement("p",{className:"center c999"},"暂无数据")),s["default"].createElement("label",null,"历史搜索"),s["default"].createElement("div",{className:"tags history"},n.map(function(t,a){return s["default"].createElement("span",{key:a,onClick:function(){return e.onTagSelected(t)}},t)}),n.length||"error"!=r.errorText?null:s["default"].createElement("p",{className:"center c999"},"暂无数据"))),o?s["default"].createElement("div",{onScroll:this.handleScroll.bind(this),className:"search-result c-body"},null,c&&!c.overlay?s["default"].createElement("p",{className:"center f10 mt12"},o,"，",this.state.total,"条结果，",(new Date).format("yyyy-MM-dd hh:mm:ss")):null,c&&!c.overlay?s["default"].createElement("div",{className:"keyword-desc"},s["default"].createElement("table",{border:"1",cellSpacing:"0"},s["default"].createElement("tr",null,s["default"].createElement("th",null,"关键词"),s["default"].createElement("th",null,"搜索热度"),s["default"].createElement("th",null,"搜索结果数")),s["default"].createElement("tr",null,s["default"].createElement("td",null,o),s["default"].createElement("td",null,this.state.hot||"-"),s["default"].createElement("td",null,this.state.total||"-")))):null,s["default"].createElement("ul",null,a.map(function(t,a){return s["default"].createElement(y["default"],{key:a,type:c.overlay?3:1,onItemClick:e.onClickSearchItem,data:t,index:a})}),this.state.loading?s["default"].createElement(f["default"],null):null,0!=this.state.total||this.state.loading?null:s["default"].createElement("div",{className:"center c999 no-search-result"},s["default"].createElement("span",null,"没有搜索到应用")))):null)}});t["default"]=C,a.exports=t["default"]});