define("pagelet/search/components/search_input.jsx",function(e,t,a){"use strict";function s(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var l=e("react"),n=s(l),c=e("reactRouter"),r=e("jquery"),i=s(r),o=e("static/minxins/utils"),u=e("pagelet/widget/components/header.jsx"),d=s(u),h=e("pagelet/widget/components/loading.jsx"),f=s(h),p=e("pagelet/widget/components/tabs.jsx"),y=s(p),m=e("pagelet/widget/components/appItem.jsx"),v=s(m),g=e("constants"),E=e("pagelet/search/action/action"),S=s(E),b=e("pagelet/search/store/store"),C=s(b),k=n["default"].createClass({displayName:"Search",mixins:[c.History],getInitialState:function(){return{tabs:[{name:"iPhone",value:g.deviceType.IPHONE},{name:"iPad",value:g.deviceType.IPAD}],searchKey:null,device:g.deviceType.IPHONE,country:g.countryCode.CHINA,searchResultList:[],hotWords:[],records:[],page:1,total:0}},componentDidMount:function(){this.unSubscribe=C["default"].listen(this.onStateChange.bind(this)),S["default"].fetchHotApp(),S["default"].fetchHistory(),o.send({type:"search",opra:"pv",label:"搜索"})},componentWillUnmount:function(){this.unSubscribe()},onStateChange:function(e){e.searchResultList&&(e.searchResultList=this.state.searchResultList.concat(e.searchResultList)),this.setState(e)},onTagSelected:function(e){this.setState({searchKey:e}),S["default"].search(e,1,this.state.country,this.state.device),S["default"].addHistory(e),o.send({type:"search",opra:"history",label:e})},onChooseDevice:function(e){var t=this;this.setState({device:e.value,searchResultList:[]},function(){S["default"].search(t.state.searchKey,1,t.state.country,t.state.device)})},onSearch:function(e){this.setState({searchKey:e,searchResultList:[],page:1,total:0}),S["default"].search(e,1,this.state.country,this.state.device),S["default"].addHistory(e),o.send({type:"search",opra:"search",label:key})},handleScroll:function(e){var t=e.target;t.offsetHeight+t.scrollTop+10>=t.scrollHeight&&!this.state.loading&&this.state.searchResultList.length<this.state.total&&this.loadMore()},loadMore:function(){var e=this.state.page+1;this.setState({page:e}),S["default"].search(this.state.searchKey,e)},onClickSearchItem:function(e){var t=this.props.location.query||{},a=i["default"].extend({},e),s="/detail/";s+=t.overlay?"4":"1",a.id=a.id||a.appId,a.device=this.state.device,a.country=g.countryToCode[a.country],this.history.pushState("",s,a),o.send({type:"search",opra:"hot",label:a.title})},render:function(){var e=this,t=this.state,a=(t.deviceType,t.searchResultList),s=this.props.location.query||{};return n["default"].createElement("div",{className:"c-page input-search"},n["default"].createElement(d["default"],{searchValue:this.state.searchKey,onSearch:this.onSearch,onCancelSearch:function(){return e.history.goBack()},type:"search"}),n["default"].createElement("div",{className:"default-view",style:{display:this.state.searchKey?"none":"block"}},n["default"].createElement("label",null,"热门应用"),n["default"].createElement("div",{className:"tags hot-app"},this.state.hotWords.map(function(t,a){return n["default"].createElement("span",{key:a,onClick:function(){return e.onClickSearchItem(t)}},t.title)})),n["default"].createElement("label",null,"历史搜索"),n["default"].createElement("div",{className:"tags history"},this.state.records.map(function(t,a){return n["default"].createElement("span",{key:a,onClick:function(){return e.onTagSelected(t)}},t)}))),n["default"].createElement("div",{onScroll:this.handleScroll.bind(this),className:"search-result c-body",style:{display:this.state.searchKey?"block":"none"}},n["default"].createElement(y["default"],{tabs:this.state.tabs,onSelect:this.onChooseDevice}),s&&!s.overlay?n["default"].createElement("p",{className:"center c999 f10"},this.state.searchKey,", ",this.state.total,"条结果 ",(new Date).format("yyyy-MM-dd hh:mm:ss")):null,s&&!s.overlay?n["default"].createElement("div",{className:"keyword-desc"},n["default"].createElement("table",{border:"1",cellSpacing:"0"},n["default"].createElement("tr",null,n["default"].createElement("th",null,"关键字"),n["default"].createElement("th",null,"搜索热度"),n["default"].createElement("th",null,"搜索结果数")),n["default"].createElement("tr",null,n["default"].createElement("td",null,this.state.searchKey),n["default"].createElement("td",null,"-"),n["default"].createElement("td",null,this.state.total||"-")))):null,n["default"].createElement("ul",null,a.map(function(t,a){return n["default"].createElement(v["default"],{key:a,type:s.overlay?3:1,onItemClick:e.onClickSearchItem,data:t,index:a})}),this.state.loading?n["default"].createElement(f["default"],null):null)))}});t["default"]=k,a.exports=t["default"]});