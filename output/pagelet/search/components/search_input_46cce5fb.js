define("pagelet/search/components/search_input.jsx",function(e,t,a){"use strict";function s(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var l=e("react"),n=s(l),c=e("reactRouter"),r=e("jquery"),i=s(r),o=e("pagelet/widget/components/header.jsx"),u=s(o),d=e("pagelet/widget/components/loading.jsx"),h=s(d),f=e("pagelet/widget/components/tabs.jsx"),m=s(f),p=e("pagelet/widget/components/appItem.jsx"),y=s(p),v=e("constants"),g=e("pagelet/search/action/action"),E=s(g),S=e("pagelet/search/store/store"),b=s(S),C=n["default"].createClass({displayName:"Search",mixins:[c.History],getInitialState:function(){return{tabs:[{name:"iPhone",value:v.deviceType.IPHONE},{name:"iPad",value:v.deviceType.IPAD}],searchKey:null,device:v.deviceType.IPHONE,country:v.countryCode.CHINA,searchResultList:[],hotWords:[],records:[],page:1,total:0}},componentDidMount:function(){this.unSubscribe=b["default"].listen(this.onStateChange.bind(this)),E["default"].fetchHotApp(),E["default"].fetchHistory()},componentWillUnmount:function(){this.unSubscribe()},onStateChange:function(e){e.searchResultList&&(e.searchResultList=this.state.searchResultList.concat(e.searchResultList)),this.setState(e)},onTagSelected:function(e){this.setState({searchKey:e}),E["default"].search(e,1,this.state.country,this.state.device),E["default"].addHistory(e)},onChooseDevice:function(e){var t=this;this.setState({device:e.value,searchResultList:[]},function(){E["default"].search(t.state.searchKey,1,t.state.country,t.state.device)})},onSearch:function(e){this.setState({searchKey:e,searchResultList:[],page:1,total:0}),E["default"].search(e,1,this.state.country,this.state.device),E["default"].addHistory(e)},handleScroll:function(e){var t=e.target;t.offsetHeight+t.scrollTop+10>=t.scrollHeight&&!this.state.loading&&this.state.searchResultList.length<this.state.total&&this.loadMore()},loadMore:function(){var e=this.state.page+1;this.setState({page:e}),E["default"].search(this.state.searchKey,e)},onClickSearchItem:function(e){var t=this.props.location.query||{},a=i["default"].extend({},e),s="/detail/";s+=t.overlay?"4":"1",a.id=a.id||a.appId,a.device=this.state.device,a.country=v.countryToCode[a.country],this.history.pushState("",s,a)},render:function(){var e=this,t=this.state,a=(t.deviceType,t.searchResultList),s=this.props.location.query||{};return n["default"].createElement("div",{className:"c-page input-search"},n["default"].createElement(u["default"],{searchValue:this.state.searchKey,onSearch:this.onSearch,onCancelSearch:function(){return e.history.goBack()},type:"search"}),n["default"].createElement("div",{className:"default-view",style:{display:this.state.searchKey?"none":"block"}},n["default"].createElement("label",null,"热门应用"),n["default"].createElement("div",{className:"tags hot-app"},this.state.hotWords.map(function(t,a){return n["default"].createElement("span",{key:a,onClick:function(){return e.onClickSearchItem(t)}},t.title)})),n["default"].createElement("label",null,"历史搜索"),n["default"].createElement("div",{className:"tags history"},this.state.records.map(function(t,a){return n["default"].createElement("span",{key:a,onClick:function(){return e.onTagSelected(t)}},t)}))),n["default"].createElement("div",{onScroll:this.handleScroll.bind(this),className:"search-result c-body",style:{display:this.state.searchKey?"block":"none"}},n["default"].createElement(m["default"],{tabs:this.state.tabs,onSelect:this.onChooseDevice}),s&&!s.overlay?n["default"].createElement("p",{className:"center c999 f10"},this.state.searchKey,", ",this.state.total,"条结果 ",(new Date).format("yyyy-MM-dd hh:mm:ss")):null,s&&!s.overlay?n["default"].createElement("div",{className:"keyword-desc"},n["default"].createElement("table",{border:"1",cellSpacing:"0"},n["default"].createElement("tr",null,n["default"].createElement("th",null,"关键字"),n["default"].createElement("th",null,"搜索热度"),n["default"].createElement("th",null,"搜索结果数")),n["default"].createElement("tr",null,n["default"].createElement("td",null,this.state.searchKey),n["default"].createElement("td",null,"123213"),n["default"].createElement("td",null,this.state.total)))):null,n["default"].createElement("ul",null,a.map(function(t,a){return n["default"].createElement(y["default"],{key:a,type:s.overlay?3:1,onItemClick:e.onClickSearchItem,data:t,index:a})}),this.state.loading?n["default"].createElement(h["default"],null):null)))}});t["default"]=C,a.exports=t["default"]});