define("pagelet/widget/components/filter.jsx",function(e,t,a){"use strict";function l(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var n=e("react"),u=l(n),c=e("reactRouter"),s=e("pagelet/widget/components/calendar.jsx"),r=l(s),i=e("pagelet/widget/components/loading.jsx"),d=l(i),o=e("constants"),f=e("reflux"),m=l(f),h=e("jquery"),y=l(h),p=m["default"].createActions(["fetchConfig","fetchConfigCmp"]);p.fetchConfig.preEmit=function(e){var t={type:"GET",url:SEARCH_HOST+"/configlist",data:e,dataType:"json"};y["default"].ajax(t).always(function(e){p.fetchConfigCmp(e)})};var v=m["default"].createStore({init:function(){this.listenTo(p.fetchConfig,this.loading),this.listenTo(p.fetchConfigCmp,this.fetchConfigCmp)},loading:function(){this.trigger({loading:!0})},fetchConfigCmp:function(e){e&&(e.loading=!1),this.trigger(e)}}),E=u["default"].createClass({displayName:"Filter",mixins:[c.History],getInitialState:function(){return{loading:!0,showCalendar:!1,score:[{name:"1星",value:1},{name:"2星",value:2},{name:"3星",value:3},{name:"4星",value:4},{name:"5星",value:5}],device:[],country:[],genres:[],subGenres:[],curSelected:{datetime:this.props.datetimeValue||null,days:this.props.daysValue||null,country:this.props.countryValue||null,device:this.props.deviceValue||null,category:this.props.categoryValue||null,pay:this.props.payValue||null,score:this.props.scoreValue||[]}}},onOk:function(){if(this.props.onOk&&this.props.onOk(this.state.curSelected),this.props.location){var e=this.props.location.pathname,t=this.props.location.query;delete t.filter,t=y["default"].extend(t,this.state.curSelected),this.history.replaceState(null,e,t)}else this.history.goBack()},componentDidMount:function(){this.unSubscribe=v.listen(this.onStateChange.bind(this)),p.fetchConfig()},componentWillUnmount:function(){this.unSubscribe()},onStateChange:function(e){this.setState(e)},onCancel:function(){this.history.goBack()},onOtherDate:function(){this.setState({showCalendar:!0})},onCanlendarCancel:function(){this.setState({showCalendar:!1})},onCalendarSelect:function(e){this.setState({showCalendar:!1});var t=this.state.curSelected;if(t.datetime=e,e.year&&this.props.datetime){var a=new Date,l=new Date(a.getTime()-864e5);e.year==a.getFullYear()&&e.month==a.getMonth()+1&&e.day==a.getDate()?(delete e.month,delete e.day,delete e.year,e.value=1,e.name=o.days2Str[e.value]):e.year==l.getFullYear()&&e.month==l.getMonth()+1&&e.day==l.getDate()?(delete e.month,delete e.day,delete e.year,e.value=-1,e.name=o.days2Str[e.value]):(e.value=e.year+"-"+e.month+"-"+e.day,e.name=e.value)}this.setState({curSelected:t})},onDevice:function(e){var t=this.state.curSelected;t.device=e,this.setState({curSelected:t})},onCountry:function(e){var t=this.state.curSelected;t.country=e,this.setState({curSelected:t})},onDatetime:function(e){var t=this.state.curSelected;t.datetime=e,this.setState({curSelected:t})},onDays:function(e){var t=this.state.curSelected;t.days=e,this.setState({curSelected:t})},onCategory:function(e){var t=this.state.curSelected;t.category=e,this.setState({curSelected:t})},onPay:function(e){var t=this.state.curSelected;t.pay=e,this.setState({curSelected:t})},onScore:function(e){{var t=this.state.curSelected;t.score.filter(function(t){return e.value==t.value?t:void 0})[0]||null}t.score=[e],this.setState({curSelected:t})},clearScore:function(){var e=this.state.curSelected;5==e.score.length?e.score=[]:(e.score=[],this.state.score.forEach(function(t){e.score.push({name:t.name,value:t.value})})),this.setState({curSelected:e})},render:function(){var e=this;if(this.state.loading)return u["default"].createElement(d["default"],null);if(this.state.showCalendar)return u["default"].createElement(r["default"],{curDatetime:this.state.curSelected.datetime,onSelected:this.onCalendarSelect,cancel:this.onCanlendarCancel});var t,a=this.state,l=a.curSelected,n=!!this.props.device,c=!!this.props.country,s=!!this.props.datetime,i=!!this.props.days,f=!!this.props.category,m=!!this.props.showPayMethod,h=!!this.props.score,y=!!this.props.showDateDay,p=l.datetime;if(p&&1!=p.value&&-1!=p.value&&7!=p.value&&15!=p.value&&30!=p.value&&60!=p.value){var v=new Date(p.year,p.month-1,p.day);t=v.format("yyyy-MM-dd")}return u["default"].createElement("div",{className:"c-filter"},u["default"].createElement("div",{className:"hdr"},"筛选",u["default"].createElement("i",{onClick:this.onCancel},"取消")),n&&a.device.length?u["default"].createElement("div",null,u["default"].createElement("h5",null,"设备"),u["default"].createElement("ul",{className:"f-type clearfix"},a.device.map(function(t){var a={};return a.onClick=function(){return e.onDevice(t)},l.device&&l.device.value==t.value&&(a.className="selected"),u["default"].createElement("li",a,u["default"].createElement("span",null,t.name))}))):null,h&&a.score.length?u["default"].createElement("div",null,u["default"].createElement("h5",null,"评级"),u["default"].createElement("ul",{className:"f-type clearfix"},u["default"].createElement("li",{onClick:this.clearScore,className:5==l.score.length?"selected":""},u["default"].createElement("span",null,"全部")),a.score.map(function(t){var a={};a.onClick=function(){return e.onScore(t)};var n=l.score.filter(function(e){return e.value==t.value?t:void 0})[0]||null;return n&&5!=l.score.length&&(a.className="selected"),u["default"].createElement("li",a,u["default"].createElement("span",null,t.name))}))):null,m?u["default"].createElement("div",null,u["default"].createElement("h5",null,"分类"),u["default"].createElement("ul",{className:"f-type clearfix"},u["default"].createElement("li",{className:l.pay&&l.pay.value==o.payType.FREE?"selected":null,onClick:function(){return e.onPay({name:"免费",value:o.payType.FREE})}},u["default"].createElement("span",null,"免费")),u["default"].createElement("li",{className:l.pay&&l.pay.value==o.payType.FEE?"selected":null,onClick:function(){return e.onPay({name:"付费",value:o.payType.FEE})}},u["default"].createElement("span",null,"付费")),u["default"].createElement("li",{className:l.pay&&l.pay.value==o.payType.HOT?"selected":null,onClick:function(){return e.onPay({name:"畅销",value:o.payType.HOT})}},u["default"].createElement("span",null,"畅销")))):null,c&&a.country.length?u["default"].createElement("div",null,u["default"].createElement("h5",null,"国家"),u["default"].createElement("ul",{className:"f-type clearfix"},a.country.map(function(t){var a={};return a.onClick=function(){return e.onCountry(t)},l.country&&l.country.value==t.value&&(a.className="selected"),u["default"].createElement("li",a,u["default"].createElement("span",null,t.name))}))):null,s?u["default"].createElement("div",null,u["default"].createElement("h5",null,"时间"),u["default"].createElement("ul",{className:"f-type clearfix"},u["default"].createElement("li",{className:l.datetime&&1==l.datetime.value?"selected":null,onClick:function(){return e.onDatetime({name:"今天",value:1})}},u["default"].createElement("span",null,"今天")),u["default"].createElement("li",{className:l.datetime&&-1==l.datetime.value?"selected":null,onClick:function(){return e.onDatetime({name:"昨天",value:-1})}},u["default"].createElement("span",null,"昨天")),u["default"].createElement("li",{className:t?"selected":"",style:{width:"50%"},onClick:this.onOtherDate},u["default"].createElement("span",null,t||"其他")))):null,i?u["default"].createElement("div",null,u["default"].createElement("h5",null,"时间"),u["default"].createElement("ul",{className:"f-type clearfix"},u["default"].createElement("li",{className:l.days&&1==l.days.value?"selected":null,onClick:function(){return e.onDays({name:"今天",value:1})}},u["default"].createElement("span",null,"今天")),u["default"].createElement("li",{className:l.days&&-1==l.days.value?"selected":null,onClick:function(){return e.onDays({name:"昨天",value:-1})}},u["default"].createElement("span",null,"昨天")),u["default"].createElement("li",{className:l.days&&7==l.days.value?"selected":null,onClick:function(){return e.onDays({name:"7日",value:7})}},u["default"].createElement("span",null,"7日")),u["default"].createElement("li",{className:l.days&&15==l.days.value?"selected":null,onClick:function(){return e.onDays({name:"15日",value:15})}},u["default"].createElement("span",null,"15日")),u["default"].createElement("li",{className:l.days&&30==l.days.value?"selected":null,onClick:function(){return e.onDays({name:"30日",value:30})}},u["default"].createElement("span",null,"30日")),u["default"].createElement("li",{className:l.days&&60==l.days.value?"selected":null,onClick:function(){return e.onDays({name:"60日",value:60})}},u["default"].createElement("span",null,"60日")))):null,y?u["default"].createElement("div",null,u["default"].createElement("h5",null,"时间"),u["default"].createElement("ul",{className:"f-type clearfix"},u["default"].createElement("li",{className:l.datetime&&7==l.datetime.value?"selected":null,onClick:function(){return e.onDatetime({name:"7日",value:7})}},u["default"].createElement("span",null,"7日")),u["default"].createElement("li",{className:l.datetime&&15==l.datetime.value?"selected":null,onClick:function(){return e.onDatetime({name:"15日",value:15})}},u["default"].createElement("span",null,"15日")),u["default"].createElement("li",{className:l.datetime&&30==l.datetime.value?"selected":null,onClick:function(){return e.onDatetime({name:"30日",value:30})}},u["default"].createElement("span",null,"30日")),u["default"].createElement("li",{className:l.datetime&&60==l.datetime.value?"selected":null,onClick:function(){return e.onDatetime({name:"60日",value:60})}},u["default"].createElement("span",null,"60日")),u["default"].createElement("li",{className:t?"selected":"",style:{width:"50%"},onClick:this.onOtherDate},u["default"].createElement("span",null,t||"其他")))):null,f&&a.genres.length?u["default"].createElement("div",null,u["default"].createElement("h5",null,"分类"),u["default"].createElement("ul",{className:"f-type clearfix"},a.genres.map(function(t){var a={style:{}};return a.onClick=function(){return e.onCategory(t)},l.category&&l.category.value==t.value&&(a.className="selected"),25==t.value||26==t.value?null:u["default"].createElement("li",a,u["default"].createElement("span",null,t.name),25==t.value?u["default"].createElement("i",{className:e.state.subGenres==t.data?"unfolder":"unfolder fd",style:{right:50}}):null,26==t.value?u["default"].createElement("i",{className:e.state.subGenres==t.data?"unfolder":"unfolder fd",style:{right:39}}):null)}))):null,f?u["default"].createElement("ul",{className:"f-type clearfix"},a.genres.map(function(t){var a={style:{}};return l.category&&l.category.value==t.value&&(a.className="selected"),25!=t.value&&26!=t.value?null:(a.style.width="50%",a.onClick=function(){var a=e.state.subGenres==t.data?[]:t.data;e.setState({subGenres:a})},t.data.filter(function(n){e.state.subGenres!=t.data&&l.category&&n.value==l.category.value&&(a.className="selected")}),u["default"].createElement("li",a,u["default"].createElement("span",null,t.name),25==t.value?u["default"].createElement("i",{className:e.state.subGenres==t.data?"unfolder":"unfolder fd",style:{right:50}}):null,26==t.value?u["default"].createElement("i",{className:e.state.subGenres==t.data?"unfolder":"unfolder fd",style:{right:39}}):null))})):null,u["default"].createElement("ul",{className:"f-type clearfix"},this.state.subGenres.map(function(t){var a={};return a.onClick=function(){return e.onCategory(t)},console.log(l.category.value,t.value),l.category&&l.category.value==t.value&&(a.className="selected"),u["default"].createElement("li",a,u["default"].createElement("span",null,t.name))})),u["default"].createElement("div",{style:{padding:"0 12px"}},u["default"].createElement("button",{onClick:this.onOk,style:{width:"100%"},className:"btn main-btn mt12 mb12"},"确定")))}});t["default"]=E,a.exports=t["default"]});