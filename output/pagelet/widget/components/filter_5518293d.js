define("pagelet/widget/components/filter.jsx",function(e,t,l){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var n=e("react"),u=a(n),c=e("reactRouter"),r=e("pagelet/widget/components/calendar.jsx"),s=a(r),i=e("pagelet/widget/components/loading.jsx"),d=a(i),o=e("constants"),m=e("reflux"),f=a(m),p=e("jquery"),h=a(p),y=f["default"].createActions(["fetchConfig","fetchConfigCmp"]);y.fetchConfig.preEmit=function(e){var t={type:"GET",url:SEARCH_HOST+"/configlist",data:e,dataType:"json"};h["default"].ajax(t).always(function(e){y.fetchConfigCmp(e)})};var E=f["default"].createStore({init:function(){this.listenTo(y.fetchConfig,this.loading),this.listenTo(y.fetchConfigCmp,this.fetchConfigCmp)},loading:function(){this.trigger({loading:!0})},fetchConfigCmp:function(e){e&&(e.loading=!1),this.trigger(e)}}),v=u["default"].createClass({displayName:"Filter",mixins:[c.History],getInitialState:function(){return{loading:!0,showCalendar:!1,score:[{name:"1星",value:1},{name:"2星",value:2},{name:"3星",value:3},{name:"4星",value:4},{name:"5星",value:5}],device:[],country:[],genres:[],curSelected:{datetime:this.props.datetimeValue||null,days:this.props.daysValue||null,country:this.props.countryValue||null,device:this.props.deviceValue||null,category:this.props.categoryValue||null,pay:this.props.payValue||null,score:this.props.scoreValue||[]}}},onOk:function(){this.props.onOk&&this.props.onOk(this.state.curSelected),this.history.goBack()},componentDidMount:function(){this.unSubscribe=E.listen(this.onStateChange.bind(this)),y.fetchConfig()},componentWillUnmount:function(){this.unSubscribe()},onStateChange:function(e){this.setState(e)},onCancel:function(){this.history.goBack()},onOtherDate:function(){this.setState({showCalendar:!0})},onCanlendarCancel:function(){this.setState({showCalendar:!1})},onCalendarSelect:function(e){this.setState({showCalendar:!1});var t=this.state.curSelected;if(t.datetime=e,e.year){var l=new Date,a=new Date(l.getTime()-864e5);e.year==l.getFullYear()&&e.month==l.getMonth()+1&&e.day==l.getDate()?(e.value=1,e.name=o.days2Str[e.value]):e.year==a.getFullYear()&&e.month==a.getMonth()+1&&e.day==a.getDate()?(e.value=-1,e.name=o.days2Str[e.value]):(e.value=e.year+"-"+e.month+"-"+e.day,e.name=e.value)}this.setState({curSelected:t})},onDevice:function(e){var t=this.state.curSelected;t.device=e,this.setState({curSelected:t})},onCountry:function(e){var t=this.state.curSelected;t.country=e,this.setState({curSelected:t})},onDatetime:function(e){var t=this.state.curSelected;t.datetime=e,this.setState({curSelected:t})},onDays:function(e){var t=this.state.curSelected;t.days=e,this.setState({curSelected:t})},onCategory:function(e){var t=this.state.curSelected;t.category=e,this.setState({curSelected:t})},onPay:function(e){var t=this.state.curSelected;t.pay=e,this.setState({curSelected:t})},onScore:function(e){var t=this.state.curSelected,l=t.score.filter(function(t){return e.value==t.value?t:void 0})[0]||null;l?t.score.splice(t.score.indexOf(l),1):t.score.push(e),this.setState({curSelected:t})},render:function(){var e=this;if(this.state.loading)return u["default"].createElement(d["default"],null);if(this.state.showCalendar)return u["default"].createElement(s["default"],{curDatetime:this.state.curSelected.datetime,onSelected:this.onCalendarSelect,cancel:this.onCanlendarCancel});var t,l=this.state,a=l.curSelected,n=!!this.props.device,c=!!this.props.country,r=!!this.props.datetime,i=!!this.props.days,m=!!this.props.category,f=!!this.props.showPayMethod,p=!!this.props.score,h=!!this.props.showDateDay,y=a.datetime;if(y&&1!=y.value&&-1!=y.value){var E=new Date(y.year,y.month-1,y.day);t=E.format("yyyy-MM-dd")}return u["default"].createElement("div",{className:"c-filter"},u["default"].createElement("div",{className:"hdr"},"筛选",u["default"].createElement("i",{className:"c999",onClick:this.onCancel},"取消")),n&&l.device.length?u["default"].createElement("div",null,u["default"].createElement("h5",null,"设备"),u["default"].createElement("ul",{className:"f-type clearfix"},l.device.map(function(t){var l={};return l.onClick=function(){return e.onDevice(t)},a.device&&a.device.value==t.value&&(l.className="selected"),u["default"].createElement("li",l,u["default"].createElement("span",null,t.name))}))):null,p&&l.score.length?u["default"].createElement("div",null,u["default"].createElement("h5",null,"评级"),u["default"].createElement("ul",{className:"f-type clearfix"},l.score.map(function(t){var l={};l.onClick=function(){return e.onScore(t)};var n=a.score.filter(function(e){return e.value==t.value?t:void 0})[0]||null;return n&&(l.className="selected"),u["default"].createElement("li",l,u["default"].createElement("span",null,t.name))}))):null,f?u["default"].createElement("div",null,u["default"].createElement("h5",null,"分类"),u["default"].createElement("ul",{className:"f-type clearfix"},u["default"].createElement("li",{className:a.pay&&a.pay.value==o.payType.FREE?"selected":null,onClick:function(){return e.onPay({name:"免费",value:o.payType.FREE})}},u["default"].createElement("span",null,"免费")),u["default"].createElement("li",{className:a.pay&&a.pay.value==o.payType.FEE?"selected":null,onClick:function(){return e.onPay({name:"付费",value:o.payType.FEE})}},u["default"].createElement("span",null,"付费")),u["default"].createElement("li",{className:a.pay&&a.pay.value==o.payType.HOT?"selected":null,onClick:function(){return e.onPay({name:"畅销",value:o.payType.HOT})}},u["default"].createElement("span",null,"畅销")))):null,c&&l.country.length?u["default"].createElement("div",null,u["default"].createElement("h5",null,"国家"),u["default"].createElement("ul",{className:"f-type clearfix"},l.country.map(function(t){var l={};return l.onClick=function(){return e.onCountry(t)},a.country&&a.country.value==t.value&&(l.className="selected"),u["default"].createElement("li",l,u["default"].createElement("span",null,t.name))}))):null,r?u["default"].createElement("div",null,u["default"].createElement("h5",null,"时间"),u["default"].createElement("ul",{className:"f-type clearfix"},u["default"].createElement("li",{className:a.datetime&&1==a.datetime.value?"selected":null,onClick:function(){return e.onDatetime({name:"今天",value:1})}},u["default"].createElement("span",null,"今天")),u["default"].createElement("li",{className:a.datetime&&-1==a.datetime.value?"selected":null,onClick:function(){return e.onDatetime({name:"昨天",value:-1})}},u["default"].createElement("span",null,"昨天")),u["default"].createElement("li",{className:t?"selected":"",style:{width:"50%"},onClick:this.onOtherDate},u["default"].createElement("span",null,t||"其他")))):null,i?u["default"].createElement("div",null,u["default"].createElement("h5",null,"时间"),u["default"].createElement("ul",{className:"f-type clearfix"},u["default"].createElement("li",{className:a.days&&1==a.days.value?"selected":null,onClick:function(){return e.onDays({name:"今天",value:1})}},u["default"].createElement("span",null,"今天")),u["default"].createElement("li",{className:a.days&&-1==a.days.value?"selected":null,onClick:function(){return e.onDays({name:"昨天",value:-1})}},u["default"].createElement("span",null,"昨天")),u["default"].createElement("li",{className:a.days&&7==a.days.value?"selected":null,onClick:function(){return e.onDays({name:"7日",value:7})}},u["default"].createElement("span",null,"7日")),u["default"].createElement("li",{className:a.days&&15==a.days.value?"selected":null,onClick:function(){return e.onDays({name:"15日",value:15})}},u["default"].createElement("span",null,"15日")),u["default"].createElement("li",{className:a.days&&30==a.days.value?"selected":null,onClick:function(){return e.onDays({name:"30日",value:30})}},u["default"].createElement("span",null,"30日")),u["default"].createElement("li",{className:a.days&&60==a.days.value?"selected":null,onClick:function(){return e.onDays({name:"60日",value:60})}},u["default"].createElement("span",null,"60日")))):null,h?u["default"].createElement("div",null,u["default"].createElement("h5",null,"时间"),u["default"].createElement("ul",{className:"f-type clearfix"},u["default"].createElement("li",{className:a.datetime&&7==a.datetime.value?"selected":null,onClick:function(){return e.onDatetime({name:"7日",value:7})}},u["default"].createElement("span",null,"7日")),u["default"].createElement("li",{className:a.datetime&&15==a.datetime.value?"selected":null,onClick:function(){return e.onDatetime({name:"15日",value:15})}},u["default"].createElement("span",null,"15日")),u["default"].createElement("li",{className:a.datetime&&30==a.datetime.value?"selected":null,onClick:function(){return e.onDatetime({name:"30日",value:30})}},u["default"].createElement("span",null,"30日")),u["default"].createElement("li",{className:a.datetime&&60==a.datetime.value?"selected":null,onClick:function(){return e.onDatetime({name:"60日",value:60})}},u["default"].createElement("span",null,"60日")),u["default"].createElement("li",{style:{width:"50%"},onClick:this.onOtherDate},u["default"].createElement("span",null,"其他")))):null,m&&l.genres.length?u["default"].createElement("div",null,u["default"].createElement("h5",null,"分类"),u["default"].createElement("ul",{className:"f-type clearfix"},l.genres.map(function(t){var l={};return l.onClick=function(){return e.onCategory(t)},a.category&&a.category.value==t.value&&(l.className="selected"),u["default"].createElement("li",l,u["default"].createElement("span",null,t.name))}))):null,u["default"].createElement("ul",{className:"f-type clearfix",style:{display:"none"}},u["default"].createElement("li",null,u["default"].createElement("span",null,"全部")),u["default"].createElement("li",null,u["default"].createElement("span",null,"流行时尚")),u["default"].createElement("li",null,u["default"].createElement("span",null,"家居园艺")),u["default"].createElement("li",null,u["default"].createElement("span",null,"户外自然")),u["default"].createElement("li",{style:{width:"50%"}},u["default"].createElement("span",null,"娱乐场游戏"),u["default"].createElement("i",{className:"unfolder"})),u["default"].createElement("li",{style:{width:"50%"}},u["default"].createElement("span",null,"报刊杂志"),u["default"].createElement("i",{className:"unfolder"}))),u["default"].createElement("div",{style:{padding:"0 12px"}},u["default"].createElement("button",{onClick:this.onOk,style:{width:"100%"},className:"btn main-btn mt12 mb12"},"确定")))}});t["default"]=v,l.exports=t["default"]});