define("pagelet/top/components/top7DownList.jsx",function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var s=e("react"),i=n(s),o=e("reactRouter"),l=e("jquery"),c=n(l),r=e("pagelet/widget/components/header.jsx"),p=n(r),u=e("pagelet/widget/components/rank.jsx"),d=(n(u),e("pagelet/widget/components/loading.jsx")),f=n(d),h=e("pagelet/widget/components/tabs.jsx"),y=n(h),g=e("pagelet/widget/components/appItem.jsx"),m=n(g),v=e("pagelet/widget/components/filter.jsx"),S=n(v),T=e("constants"),b=e("pagelet/top/action/action"),E=n(b),x=e("pagelet/top/store/store"),w=n(x),I=i["default"].createClass({displayName:"Top7DownList",mixins:[o.History],getInitialState:function(){var e=[{name:"免费榜",payType:T.payType.FREE},{name:"付费榜",payType:T.payType.FEE},{name:"畅销榜",payType:T.payType.HOT}];return{loading:!1,flag:2,tabIndex:0,tabs:e,list:[],genres:"总榜",payType:T.payType.FREE,device:T.deviceType.IPHONE,country:T.countryCode.CHINA,page:1,pageSize:20}},componentDidMount:function(){this.unSubscribe=w["default"].listen(this.onStateChange.bind(this)),this.fetchList()},componentWillUnmount:function(){this.unSubscribe()},fetchList:function(){E["default"].fetDownTopList({genres:this.state.genres,type:this.state.payType,device:this.state.device,country:this.state.country})},onStateChange:function(e){this.setState(e)},handleScroll:function(e){var t=e.target;t.offsetHeight+t.scrollTop+10>=t.scrollHeight&&this.loadMore()},loadMore:function(){var e=this.state.page+1;this.setState({page:e})},onItemClick:function(e){var t=c["default"].extend({},e);this.history.pushState("","detail/1",t)},onSelectTab:function(e,t){var a=this;this.setState({tabIndex:t,list:[],page:1,payType:e.payType},function(){a.fetchList()})},onFilter:function(e){var t=this,a={list:[],page:1};e.device&&(a.device=e.device.value),e.country&&(a.country=e.country.value),e.category&&(a.genres=e.category.name),this.setState(a,function(){t.fetchList()})},render:function(){var e=this.props.location.query;return e.filter?i["default"].createElement(S["default"],{onOk:this.onFilter,device:!0,country:!0,category:!0}):this.renderTop()},renderTop:function(){var e=this,t=this.state.list||[];return t=t.slice(0,this.state.page*this.state.pageSize),i["default"].createElement("div",{className:"c-page top7-up-list"},i["default"].createElement(p["default"],{location:this.props.location,filterEnabled:!0,showSideNav:this.props.showSideNav},"七日排名下降榜"),i["default"].createElement("div",{className:"c-body",onScroll:this.handleScroll},i["default"].createElement(y["default"],{tabIndex:this.state.tabIndex,onSelect:this.onSelectTab,tabs:this.state.tabs}),i["default"].createElement("p",{className:"f12 center f-txt"},this.state.genres,"  ",T.countryCode2Str[this.state.country],"  ",T.deviceTypeStr[this.state.device]),i["default"].createElement("ul",{className:"list"},t.map(function(t,a){return i["default"].createElement(m["default"],{flag:e.state.flag,type:2,onItemClick:e.onItemClick,index:a,data:t})})),this.state.loading?i["default"].createElement(f["default"],null):null))}});t["default"]=I,a.exports=t["default"]});