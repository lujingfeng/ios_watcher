define("pagelet/compproduct/components/index.jsx",function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var s=e("react"),l=n(s),i=e("reactRouter"),c=e("pagelet/widget/components/header.jsx"),o=n(c),r=e("pagelet/widget/components/loading.jsx"),u=n(r),d=e("pagelet/widget/components/tabs.jsx"),h=(n(d),e("pagelet/widget/components/appItem.jsx")),p=n(h),f=e("constants"),m=e("pagelet/compproduct/components/my_fav_item.jsx"),g=(n(m),e("pagelet/search/action/action")),v=n(g),y=e("pagelet/search/store/store"),S=n(y),C=e("pagelet/myfav/action/action"),b=n(C),E=e("pagelet/myfav/store/store"),I=n(E),x=l["default"].createClass({displayName:"AppCompare",mixins:[i.History],getInitialState:function(){return{loading:!1,searchKey:null,searchResultList:[],favList:[],page:1,total:0}},componentDidMount:function(){this.unSubscribe=S["default"].listen(this.onStateChange.bind(this)),this.unFavSubscribe=I["default"].listen(this.onFavStateChange.bind(this)),b["default"].fetFavLsit()},componentWillUnmount:function(){this.unSubscribe(),this.unFavSubscribe()},onStateChange:function(e){e.searchResultList&&(e.searchResultList=this.state.searchResultList.concat(e.searchResultList)),this.setState(e)},onFavStateChange:function(e){e.list&&(e.favList=e.list),this.setState(e)},onSearch:function(e){this.setState({searchKey:e,searchResultList:[],page:1,total:0}),v["default"].search(e,1)},handleScroll:function(e){var t=e.target;t.offsetHeight+t.scrollTop+10>=t.scrollHeight&&!this.state.loading&&this.state.searchResultList.length<this.state.total&&this.loadMore()},loadMore:function(){var e=this.state.page+1;this.setState({page:e}),v["default"].search(this.state.searchKey,e)},onClickItem:function(e){var t={},a=this.props.location.query||{};t.app_1=a,t.app_2=e,e.device=f.deviceStrToint[e.device],e.country=f.countryToCode[e.country];var n="/appcompare";this.history.pushState(null,n,t)},onClickFavItem:function(e){e.id=e.id||e.appId,e.device=f.deviceStrToint[e.device],e.country=f.countryToCode[e.country],this.onClickItem(e)},render:function(){var e=this,t=this.state,a=t.searchResultList,n=t.searchKey,s=t.favList,i=this.props.location.query||{},c=i.id||i.appId;return l["default"].createElement("div",{className:"c-page comp-analysis"},l["default"].createElement(o["default"],{searchValue:n,onSearch:this.onSearch,placeholder:"搜索应用查看排名对比",onCancelSearch:function(){return e.history.goBack()},type:"search"}),l["default"].createElement("div",{className:"appselected"},l["default"].createElement(p["default"],{type:4,data:i})),l["default"].createElement("div",{onScroll:this.handleScroll.bind(this),className:"search-result c-body"},a.length?l["default"].createElement("ul",{className:"search-list"},a.map(function(t,a){var n=t.id||t.appId;return n==c?null:l["default"].createElement(p["default"],{key:a,type:5,onItemClick:e.onClickItem,data:t,index:a})}),this.state.loading?l["default"].createElement(u["default"],null):null):null,this.state.loading||a.length||!s.length?null:l["default"].createElement("ul",{className:"my-fav-list clearfix"},l["default"].createElement("h5",{className:"title"},l["default"].createElement("i",null),"关注对比"),s.map(function(t,a){var n=t.id||t.appId;return n==c?null:l["default"].createElement(p["default"],{index:a,type:5,isCompare:!0,data:t,onItemClick:e.onClickFavItem})})),this.state.loading?l["default"].createElement(u["default"],null):null))}});t["default"]=x,a.exports=t["default"]});